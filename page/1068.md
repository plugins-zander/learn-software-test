# 等价类划分法

等价类划分法是根据程序规格说明书对输入范围进行划分，将所有可能的输入数据按相关的规定划分成若干不相交的子集。所有子集的并集是整个输入域。其中，子集的互不相交保证子集中无冗余性，子集的并集是整个输入域，确定了所有子集的完备性。

## 缺陷的定位

一个软件的全部输入的集合可以至少分为两个子集：一个包含所有正常和合法的输入；另一个包含所有异常和非法的输入。对于这两个子集又可以进一步划分为若干子集，以便软件针对不同的子集，其运行的结果不同。等价类划分方法就是要从这两个集合或其子集中选择适当的输入作为测试用例，以便发现软件中存在的缺陷。



## 等价类的划分

等价类划分的原则是用同一等价类中的任意输入对软件进行测试，软件都输出的相同的结果。全部等价类的测试用例就构成了完整的测试用例集。对于同一输入域进行等价类划分，其结果可能不唯一的。因此，利用等价类划分的方法产生的测试用例集也可能不同。所以测试用例集的故障检测效率往往取决于测试人员的测试设计的经验、对软件需求的熟悉程序等。

### （1）划分等价类

在划分等价类时，分为有效等价类和无效等价类。有效等价类是指符合程序规格说明书，有意义的、合理的输入数据所构成的集合。有效等价类可以是一个，也可以是多个。利用有效等价类，可以检查软件功能和性能是否符合规格说明书中的要求。无效等价类是指不符合程序规格说明书、不合理或无意义的输入数据所构成的集合。可以是一个，也可以是多个。利用无效等价类，可以检查软件功能和性能的实现是否有不符合规格说明书的地方。

### （2）常用的等价类划分原则

- ①变量的等价类划分
  取值范围：如果输入条件规定了一个取值范围或值的个数，则可以定义一个有效等价类和两个无效等价类。字符串：至少分为一个包含所有合法字符串的有效等价类和一个包含所有非法字符串的无效等价类。枚举变量：每个取值对应一个有效等价。针对枚举类型，对于某些特定的取值范围，有可能无法确定非法测试输入值。对于布尔变量，只有两个合法取值（真值与假值）。数组：数组是一组具有相同类型的元素的集合，数组的长度及其类型都可作为等价类划分的依据。可划分为一个包含所有数组的有效等价类，一个空数组无效等价类，以及一个包含所有大于期望长度数组的无效等价类。复合数据类型：复合数据类型是指包含两个或两个以上的相互独立的属性的输入数据。当对软件的一个组件模块（函数或对象）进行测试时，将使用这种输入类型。对这种复合数据类型的输入进行等价类划分时，需要考虑输入数据的每个属性的合法与非法取值。
- ②关系与等价类划分
  在集合论中，关系指的是一个n元组的集合。如果规定了输入值的集合，或者规定了“必须如何”的条件，则可以定义一个有效等价类和一个无效等价类。如果规定了输入数据的一组值，而且程序对不同输入值做不同处理，则可以定义若干有效等价类（每个值一个有效等价类）和一个无效等价类。如果规定了输入数据必须遵守的规则，则可以定义一个有效等价类（符合规则）和若干无效等价类（从不同角度违反规则）。
- ③一元化分与多元化分
  一元化等价类划分：每次只考虑一个输入变量，这样，每个输入变量形成了对输入域的一个划分，称为一元等价类划分，简称一无化分。程序有多少个变量，就有多少种划分，每个划分包含两个或两个以上的等价类。多元划分：将所有输入变量的笛卡儿积作为程序的输入域，称为多元等价类划分，简称多元化分。此方法只产生一个划分，划分包含若干个等价类。测试用例的选择常使用一元化分，因为一元化分较为简单且可量测。而多元化分所产生的等价类数量较大，并且其中有许多是无用的。

### （3）划分等价类的步骤

确定输入域：分析需求并确定所有的输入、输出量，以及变量类型和变量使用条件。等价类划分：将每个变量的取值集合划分为互不相交的子集，每个子集对应一个等价类，所有的等价类就构成了对输入域的一个划分。组合等价类：使用多元化方法，可以将等价类组合起来。确定不可测的等价类：有些输入数据组合在实际测试过程中是无法生成的，包含这种数据的等价类就是不可测试等价类。不可测试数据指无法输入到被测软件中的那些数据组合。

### （4）等价类的测试步骤

①划分等价类，形成等价类表；

②为每个等价类规定一个唯一的编号；

③设计一个新的测试用例，使其尽量多地覆盖尚未被覆盖的有效等价类，重复这一步，直到所有的有效等价类都被覆盖为止。

④设计一个新的测试用例。使其覆盖一个而且只覆盖一个无效等价类，重复这一步，直到所有无效等价类均被覆盖为止。







## 基于等价类的测试用例设计

- 例4-1 对热水器温控软件划分等价类并设计测试用例

  - 题目

    - 

      ![img](https://img1.zlogs.net/20/20200117222928.png)

      ![img](https://img1.zlogs.net/20/20200117222929.png)

      ![img](https://img1.zlogs.net/20/20200117222930.png)

  - 步骤1：确定输入域

    - 

      ![img](https://img1.zlogs.net/20/20200117222931.png)

  - 步骤2：等价类划分

    - 

      ![img](https://img1.zlogs.net/20/20200117222932.png)

  - 步骤3：组合等价类

    - 由表4-2中可知，变量V，F，cmd，tempch代表的集合分别补划分成3个、2个、4个、5个子集，因此这4个变量共形成3×2×4×5=120个等价类，其中有些是不可测等价类

  - 步骤4：剔除不可测等价类

    - 

      ![img](https://img1.zlogs.net/20/20200117222933.png)

      ![img](https://img1.zlogs.net/20/20200117222934.png)

  - 步骤5：根据可测等价类设计测试用例

    - 

      ![img](https://img1.zlogs.net/20/20200117222935.png)

- 例4-2 三角形问题的等价类测试

  - 

    ![img](https://img1.zlogs.net/20/20200117222936.png)

    ![img](https://img1.zlogs.net/20/20200117222937.png)

    ![img](https://img1.zlogs.net/20/20200117222938.png)

    ![img](https://img1.zlogs.net/20/20200117222939.png)

    ![img](https://img1.zlogs.net/20/20200117222940.png)